<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />	
  <script src='http://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.js'></script>
  <script src='https://raw.github.com/timrwood/moment/1.7.2/min/moment.min.js'></script>

  <link href='http://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.css' rel='stylesheet' />

  <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.0/themes/base/jquery-ui.css" />
  <link href='http://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.css' rel='stylesheet' />
  <style>
    .marker-image {
    width:100px;
    height:100px;
    border:1px solid #FF0044;
    margin-left:-51px;
    margin-top:-51px;
    pointer-events:all;
    position:absolute;
	}
    
    body { margin:0; padding:0; }
    a:link, a:visited, a:active, a:hover {
				color:#FF0044;
				font-family: sans-serif; 
				text-decoration:none;}
	a:hover {color:#CCC;}  /* mouse over link */
	#label {
	  position:absolute;
	  top:80px;
	  left:90px;
	  width:158px;
	  margin-left:-80px;
	  z-index:1000;
	  font:13px/18px;
	  font-family:sans-serif;
	  color:#F03;
	  text-align:center;
	}
    #map { position:absolute; top:0; bottom:0; width:100%; }
		
  </style>
</head>
<body>
<div id='map'>
	</div>
		<div id='label'>TIMCASTELIJN made this  (on purpose..)
		<p>dubbelclick to add your own listing</p>
		<p><a href = "http://timcastelijn.nl" style="color:#F03"}>back to timcastelijn.nl</a></p>
	</div>
</div>
</body>	

<script>




//initialize map
var map = mapbox.map('map');
map.addLayer(mapbox.layer().id('timcastelijn.map-js7ghzbm'));


//zoom function
map.ui.zoomer.add();


var features = [];

window.jsonFlickrApi = function(rsp) {

    var photos = rsp.photos.photo;
    for (var i = 0; i < photos.length; i++) {
        var p = photos[i];
        
        var thumb = [ 'http://farm', p.farm, '.static.flickr.com/', p.server, '/', p.id, '_', p.secret, '_s.jpg' ].join('');            
        var url = [ 'http://farm', p.farm, '.static.flickr.com/', p.server, '/', p.id, '_', p.secret, '_m.jpg' ].join('');    
        var id = p.id;
        
        //http://api.flickr.com/services/rest/?method=flickr.photos.getInfo&api_key=a08b5f6454d8e7c77c2fd5f75cf4b72e&id=8447950504&format=json
        /*var script = document.createElement('script');
		script.src = 'http://api.flickr.com/services/rest/?'+
               'method=flickr.photos.getInfo&'+
               'api_key=a08b5f6454d8e7c77c2fd5f75cf4b72e&'+
               'id=;
		document.getElementsByTagName('head')[0].appendChild(script);
        */
        
        
        features.push({"geometry":{
        				"type": "Point", 
        				"coordinates": [p.longitude, p.latitude]},
        			"properties":{
        				"img": thumb, 
        				"image": url, 
        				"name":p.title, 
        				"description": "something"}
        			});
    }

	

	var stringJson = JSON.stringify(features);
	
	var markers = mapbox.markers.layer().features(features).factory(function(f) {
    // Define a new factory function. This takes a GeoJSON object
    // as its input and returns an element - in this case an image -
    // that represents the point.
        var img = document.createElement('img');
        img.className = 'marker-image';
        img.setAttribute('src', f.properties.img);
        return img;
    });
    //*/
    
	var interaction = mapbox.markers.interaction(markers);
	mapbox.markers.interaction(markers);

    map.addLayer(markers)
        .setExtent(markers.extent());
        
	// Set a custom formatter for tooltips
	// Provide a function that returns html to be used in tooltip
	interaction.formatter(function(feature) {
	    var o = '<a target="_blank" href="' + feature.properties.image + '">' +
	        '<img src="' + feature.properties.image + '">' +
	        '<p>' + feature.properties.name + '</p>' +
	        '</a>' +
	        '<p>' + feature.properties.description +'</p>';
	    return o;
	});

	// Zoom and center the map
	map.zoom(12).center({ lat: 52.1, lon: 5.07 });


}

/*
function httpGet(theUrl)
    {
    var xmlHttp = null;

    xmlHttp = new XMLHttpRequest();
    xmlHttp.open( "GET", theUrl, false );
    xmlHttp.send( null );
    return xmlHttp.responseText;
}

var stringJson = httpGet('http://api.flickr.com/services/rest/?'+
               'method=flickr.photos.search&'+
               'api_key=a08b5f6454d8e7c77c2fd5f75cf4b72e&'+
               'user_id=92325211@N08&'+ 
               'min_upload_date='+ date +'&'+
               //'tags=clouds&'+
               'extras=geo&' +
               'has_geo=1&'+
               'format=json')
console.log(stringJson);
*/

var date = moment().subtract('days', 5).format('YYYY-MM-DD');
//moment().subtract('days', 10).calendar();

console.log(date);

var script = document.createElement('script');
script.src = 'http://api.flickr.com/services/rest/?'+
               'method=flickr.photos.search&'+
               'api_key=a08b5f6454d8e7c77c2fd5f75cf4b72e&'+
               'user_id=92325211@N08&'+ 
               'min_upload_date='+ date +'&'+
               //'tags=clouds&'+
               'extras=geo&' +
               'has_geo=1&'+
               'format=json';
document.getElementsByTagName('head')[0].appendChild(script);


//http://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=a08b5f6454d8e7c77c2fd5f75cf4b72e&user_id=92325211@N08&extras=geo&has_geo=1&format=json




// Attribute map
map.ui.attribution.add()
    .content('<a href="http://mapbox.com/about/maps">Terms &amp; Feedback</a>');
</script>

</body>
</html>

